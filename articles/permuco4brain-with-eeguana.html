<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using `permuco4brain` with `eeguana` • permuco4brain</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using `permuco4brain` with `eeguana`">
<meta property="og:description" content="permuco4brain">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">permuco4brain</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/download-example-cheval.html">Download example of full scalp EEG data</a>
    </li>
    <li>
      <a href="../articles/figure-ggplot2.html">Figure using ggplot2</a>
    </li>
    <li>
      <a href="../articles/permuco4brain-with-eeguana.html">Using `permuco4brain` with `eeguana`</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jaromilfrossard/permuco4brain/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="permuco4brain-with-eeguana_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using <code>permuco4brain</code> with <code>eeguana</code>
</h1>
                        <h4 data-toc-skip class="author">Jaromil Frossard</h4>
            
            <h4 data-toc-skip class="date">2021-03-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jaromilfrossard/permuco4brain/blob/master/vignettes/permuco4brain-with-eeguana.Rmd" class="external-link"><code>vignettes/permuco4brain-with-eeguana.Rmd</code></a></small>
      <div class="hidden name"><code>permuco4brain-with-eeguana.Rmd</code></div>

    </div>

    
    
<div id="extracting-3d-array-using-eeguana" class="section level3">
<h3 class="hasAnchor">
<a href="#extracting-3d-array-using-eeguana" class="anchor"></a>Extracting 3D array using eeguana</h3>
<p>The <code>eeguana</code> package <span class="citation">(Nicenboim 2018)</span> provides tools for the pre-processing of EEG data. Once the pre-processing is done with <code>eeguana</code>, the 3D matrix/array of the signals should be extracted from the <code>eeguana</code>. To perform the cluster-mass test, this 3D matrix/array is the left part of the formula of the <code><a href="../reference/brainperm.html">brainperm()</a></code> function.</p>
<p>The EEG data <span class="citation">(Nicenboim 2019)</span> available on the Open Science Framework repository was analyzed using the <code>eeguana</code> package by <span class="citation">Nicenboim, Vasishth, and Rösler (2019)</span>. We use the same data-set in the following tutorial.</p>
</div>
<div id="downloading-data-from-osf" class="section level3">
<h3 class="hasAnchor">
<a href="#downloading-data-from-osf" class="anchor"></a>Downloading data from OSF</h3>
<p>From the <a href="https://osf.io/ut7xq/" class="external-link">EEG data</a> repository we found the “03_data_summarization.Rmd” file which provides functions to easily download the EE data. It is a large dataset (more than 20GB) so we only download the pre-processed signals performed using <a href="https://en.wikipedia.org/wiki/Independent_component_analysis" class="external-link">ICA</a>. Following the first chunk of the “03_data_summarization.Rmd” file you should have (at least):</p>
<ol style="list-style-type: decimal">
<li>A folder <code>data/</code> containing 5 csv files, 2 tsv files and 2 folders.</li>
<li>The folder <code>data/preproc_ica/</code> contains 120 RDA files (1 for each subject). Each file contains an <code>eeg_lst</code> object from eeguana with pre-processed EEG data.</li>
<li>The folder <code>data/opensesame_files/</code> contains 120 csv files (1 for each subject)</li>
</ol>
</div>
<div id="r-package" class="section level2">
<h2 class="hasAnchor">
<a href="#r-package" class="anchor"></a>R package</h2>
<p>In the following analysis, we will mainly use functions from the <code>tidyverse</code> <span class="citation">(Wickham et al. 2019)</span>, from <code>eeguana</code> <span class="citation">(Nicenboim 2018)</span>, from <code>permuco</code> <span class="citation">(Frossard and Renaud 2020b)</span>, from <code>permuco4brain</code> <span class="citation">(Frossard and Renaud 2020a)</span>, from <code>future</code> <span class="citation">(Bengtsson 2020)</span> and from <code>igraph</code> <span class="citation">(Csardi and Nepusz 2006)</span>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">eeguana</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jaromilfrossard/permuco" class="external-link">permuco</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jaromilfrossard/permuco4brain" class="external-link">permuco4brain</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://igraph.org" class="external-link">igraph</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/HenrikBengtsson/future" class="external-link">future</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="computing-the-erps" class="section level2">
<h2 class="hasAnchor">
<a href="#computing-the-erps" class="anchor"></a>Computing the ERPs</h2>
<p>First, we compute ERPs following the design of the experiment and save them in the folder <code>data_erp/</code>. To reduce the number of samples (and the computing time), we delete samples (or time-point) before the event and downsample to 256Hz. Finally, the ERPs are computed by taking the average for each sample, each channel and each experimental condition, which are the interaction between the <code>within</code> participant factors <code>region</code> and <code>cond</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datadir</span> <span class="op">&lt;-</span> <span class="st">"data/preproc_ica/"</span>

<span class="va">lf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">datadir</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lf</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
  <span class="va">eeg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">datadir</span>,<span class="va">lf</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">erp</span> <span class="op">&lt;-</span> <span class="va">eeg</span><span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.sample</span><span class="op">&gt;=</span><span class="fl">0</span><span class="op">)</span><span class="op">%&gt;%</span>
    <span class="fu">eeg_downsample</span><span class="op">(</span>.q<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">.recording</span>,<span class="va">.sample</span>,<span class="va">region</span>,<span class="va">cond</span><span class="op">)</span><span class="op">%&gt;%</span>
    <span class="fu">summarize_at</span><span class="op">(</span><span class="fu">channel_names</span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">erp</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"data_erp/"</span>,<span class="va">lf</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The previous script should produce 120 files in the folder <code>data_erp/</code>, one for each participant.</p>
<p>The ERP can be combine into 1 <code>eeg_lst</code> object by running:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datadir</span> <span class="op">&lt;-</span> <span class="st">"data_erp/"</span>
<span class="va">lf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">datadir</span><span class="op">)</span>

<span class="va">erps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lf</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
  <span class="va">erps</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">datadir</span>,<span class="va">lf</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>subject_nr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">.recording</span>,<span class="st">"[._]"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">erps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"bind"</span>,<span class="va">erps</span><span class="op">)</span></code></pre></div>
<p>Now, the <code>erps</code> object contains the ERPs for all participants. It is <code>eeg_lst</code> object which can be manipulated using the functions from <code>eeguana</code>.</p>
</div>
<div id="adding-the-between-participant-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-the-between-participant-variables" class="anchor"></a>Adding the <code>between</code>-participant variables</h2>
<p>We download the <code>between</code>-participant variables by combining 4 files. We choose to keep the age, the batch and the occupation as <code>between</code>-participant factors.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_subj</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/students.csv"</span><span class="op">)</span> <span class="op">%&gt;%</span>
                         <span class="fu">mutate</span><span class="op">(</span>batch <span class="op">=</span><span class="fl">1</span>, student <span class="op">=</span> <span class="st">"yes"</span><span class="op">)</span>,
                       <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/students_2.csv"</span><span class="op">)</span> <span class="op">%&gt;%</span>
                         <span class="fu">mutate</span><span class="op">(</span>batch <span class="op">=</span><span class="fl">2</span>, student <span class="op">=</span> <span class="st">"yes"</span><span class="op">)</span>,
                       <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/nonstudents.csv"</span><span class="op">)</span> <span class="op">%&gt;%</span>
                         <span class="fu">mutate</span><span class="op">(</span>batch <span class="op">=</span><span class="fl">1</span>, student <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span>,
                       <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/nonstudents_2.csv"</span><span class="op">)</span><span class="op">%&gt;%</span>
                         <span class="fu">mutate</span><span class="op">(</span>batch <span class="op">=</span><span class="fl">2</span>, student <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span>subj_order <span class="op">=</span> <span class="va">NR</span>, <span class="va">subject_nr</span>, age <span class="op">=</span> <span class="va">Alter</span>, <span class="va">batch</span>, 
         occupation <span class="op">=</span> <span class="va">student</span><span class="op">)</span></code></pre></div>
<p>The <code>.csv</code> data does not contain the <code>between</code>-participants variables for all participants, so we choose to delete 8 participants from our analysis.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">subject_to_rm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">21</span>,<span class="fl">35</span>,<span class="fl">316</span>,<span class="fl">111</span>,<span class="fl">222</span>,<span class="fl">322</span>,<span class="fl">98</span>,<span class="fl">245</span><span class="op">)</span>

<span class="va">erps</span> <span class="op">&lt;-</span> 
  <span class="va">erps</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">subject_nr</span><span class="op">%in%</span><span class="va">subject_to_rm</span><span class="op">)</span><span class="op">)</span>

<span class="va">df_subj</span> <span class="op">&lt;-</span> 
  <span class="va">df_subj</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">subject_nr</span><span class="op">%in%</span><span class="va">subject_to_rm</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Finally, we merge the <code>between</code>-participants variables to the <code>erps</code> object and also remove the signals from the ocular and reference channels the <code>erps</code> object.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">erps</span> <span class="op">&lt;-</span> 
  <span class="va">erps</span><span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">df_subj</span> ,by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"subject_nr"</span><span class="op">)</span><span class="op">)</span>

<span class="va">chan_to_rm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M1"</span>,<span class="st">"M2"</span>,<span class="st">"HEOG"</span>,<span class="st">"VEOG"</span><span class="op">)</span>
<span class="va">erps</span> <span class="op">&lt;-</span> 
  <span class="va">erps</span><span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu">one_of</span><span class="op">(</span><span class="va">chan_to_rm</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="extracting-the-3d-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-the-3d-matrix" class="anchor"></a>Extracting the 3D matrix</h2>
<p>We extract the 3D matrix using the following script. The dimensions are the design <span class="math inline">\(\times\)</span> the samples <span class="math inline">\(\times\)</span> the channels.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">signal</span> <span class="op">&lt;-</span> 
  <span class="va">erps</span><span class="op">%&gt;%</span>
  <span class="fu">signal_tbl</span><span class="op">(</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">.id</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu">nest</span><span class="op">(</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">data</span>,<span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">.x</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu">pull</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu">invoke</span><span class="op">(</span><span class="fu">abind</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/abind/man/abind.html" class="external-link">abind</a></span>,<span class="va">.</span>,along <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/aperm.html" class="external-link">aperm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The design which contains both the between and within variables is simply extracted using the <code>segments_tbl()</code> function. Moreover, we center the covariate as it will make more sense for the test.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">design</span> <span class="op">&lt;-</span> 
  <span class="fu">segments_tbl</span><span class="op">(</span><span class="va">erps</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>age_c <span class="op">=</span> <span class="va">age</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Finally the graph of adjacency is computed using the 32 channels layout data in <code>eeguana</code> and the <code><a href="../reference/position_to_graph.html">position_to_graph()</a></code> function from <code>permuco4brain</code>. Moreover, we can check the adjacency graph using the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function from <code>igraph</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">layout</span> <span class="op">&lt;-</span> 
  <span class="fu">channels_tbl</span><span class="op">(</span><span class="va">erps</span><span class="op">)</span>

<span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/position_to_graph.html">position_to_graph</a></span><span class="op">(</span><span class="va">layout</span>, delta <span class="op">=</span> <span class="fl">.75</span>,name <span class="op">=</span> <span class="va">.channel</span>,
                          x <span class="op">=</span> <span class="va">.x</span>, y <span class="op">=</span> <span class="va">.y</span>, z <span class="op">=</span> <span class="va">.z</span><span class="op">)</span></code></pre></div>
<p>You can use <code><a href="https://rdrr.io/pkg/igraph/man/rglplot.html" class="external-link">igraph::rglplot(graph)</a></code> to have a 3D representation of the adjacency between channels. Before running the clustermass test, you may want to save the 3 objects: the 3D array containing the signals, the dataframe containing the design and the graph defining the spatial adjacency of the channels.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># save(signal = signal,</span>
<span class="co">#      design = design,</span>
<span class="co">#      graph = graph,file = "signal_design_graph.RData")</span></code></pre></div>
<p>Finally, we use <code>permuco4brain</code> for testing the difference between experimental conditions. We have a repeated measures ANCOVA, with 1 covariate (the centered age), 1 between-participants factors (the occupation) and 2 within-participants factors (region and condition). The permutation tests is computed for all samples, all channels while controlling for the family-wise error rate (FWER).</p>
<p>The <code><a href="https://rdrr.io/pkg/future/man/plan.html" class="external-link">plan()</a></code> function from the <a href="https://github.com/HenrikBengtsson/future" class="external-link"><code>future</code> package</a> handles multi-cores computing</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">signal</span> <span class="op">~</span> <span class="va">age_c</span><span class="op">*</span><span class="va">occupation</span><span class="op">*</span><span class="va">region</span><span class="op">*</span><span class="va">cond</span> <span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/aov.html" class="external-link">Error</a></span><span class="op">(</span><span class="va">.recording</span><span class="op">/</span><span class="op">(</span><span class="va">region</span><span class="op">*</span><span class="va">cond</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/future/man/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brainperm.html">brainperm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, data <span class="op">=</span> <span class="va">design</span>, graph <span class="op">=</span> <span class="va">graph</span><span class="op">)</span></code></pre></div>
<div id="bibliography" class="section level3 unnumbered">
<h3 class="hasAnchor">
<a href="#bibliography" class="anchor"></a>Bibliography</h3>
<div id="refs" class="references">
<div id="ref-future">
<p>Bengtsson, Henrik. 2020. <em>A Unifying Framework for Parallel and Distributed Processing in R Using Futures</em>. <a href="https://arxiv.org/abs/2008.00553" class="external-link">https://arxiv.org/abs/2008.00553</a>.</p>
</div>
<div id="ref-csardi_igraph">
<p>Csardi, Gabor, and Tamas Nepusz. 2006. “The Igraph Software Package for Complex Network Research.” <em>InterJournal</em> Complex Systems: 1695. <a href="http://igraph.org" class="external-link">http://igraph.org</a>.</p>
</div>
<div id="ref-frossard_permuco4brain">
<p>Frossard, Jaromil, and Olivier Renaud. 2020a. <em>Permuco4brain: Extension of Permuco on Time-Space Data, Like Full Scalp Eeg</em>. <a href="https://github.com/jaromilfrossard/permuco4brain" class="external-link">https://github.com/jaromilfrossard/permuco4brain</a>.</p>
</div>
<div id="ref-frossard_permuco">
<p>———. 2020b. <em>Permuco: Permutation Tests for Regression, (Repeated Measures) Anova/Ancova and Comparison of Signals</em>.</p>
</div>
<div id="ref-nicenboim_eeguana_2020">
<p>Nicenboim, Bruno. 2018. <em>eeguana: A Package for Manipulating EEG Data in R</em>. <a href="https://doi.org/10.5281/zenodo.2533138" class="external-link">https://doi.org/10.5281/zenodo.2533138</a>.</p>
</div>
<div id="ref-nicenboim_eeg_2019">
<p>———. 2019. “EEG Data.” <a href="osf.io/ut7xq">osf.io/ut7xq</a>.</p>
</div>
<div id="ref-nicenboim2019words">
<p>Nicenboim, Bruno, Shravan Vasishth, and Frank Rösler. 2019. “Are Words Pre-Activated Probabilistically During Sentence Comprehension? Evidence from New Data and a Bayesian Random-Effects Meta-Analysis Using Publicly Available Data.”</p>
</div>
<div id="ref-tidyverse">
<p>Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. “Welcome to the tidyverse.” <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686" class="external-link">https://doi.org/10.21105/joss.01686</a>.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jaromil Frossard, Olivier Renaud.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
